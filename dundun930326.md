---
timezone: Asia/Shanghai
---

# dundun

1. 自我介绍
我是來自台灣的大三生，有過一些Solidity的基礎，想藉由這次的殘酷共學來推動自己學習更多以太坊底層的知識。
2. 你认为你会完成本次残酷学习吗？
會！
3. TG 联系方式：@dundun326
## Notes

<!-- Content_START -->

### 2025.02.06

今天是共學的第一天，主要的內容是著重在2024study group的week1，學習到了有關於一些以太坊的歷史和哲學心態的方面，沒想到居然和UNIX有關。
最重要的是這次終於了解圖靈完備是什麼意思了，簡單來說有圖靈完備就是可以跑所有圖靈機可以運行的工作，更白話就是可以做到所以有函數可以描述的工作，而以太坊具有圖靈完備性，可以運行智能合約，相較之下的bitcoin 網路就做不到。
晚點希望可以把影片看完，目前看到比較熟悉的密碼學了，另外好像可以跑一下上面code的test，應該滿有趣的。

### 2025.02.07
###節點
今天進一步瞭解「節點」的定義：在操作成面有執行層和共識層，一個客戶端可以去執行其中一項或是兩個都執行，那運行這個客戶端並且連上網路的電腦就會被叫做的節點(node)。
###測試
再來就是測試，一個成熟的應用一定需要經過大量的測試去確保他的安全性，在week1中有提到許多測試的工具可以做使用。
week1的最後總結了許多額外連結，有需要可以去看看。
也把week1的影片全部看完了。

### 2025.02.08
今天時間比較少，看了一下week2的影片，他蠻詳細的講解了共識層和執行層的邏輯，我覺得滿有趣的，希望晚一點可以有時間繼續。

### 2025.02.09
今天把week2影片看得差不多，但對於responsibility、p2p、snap還不太了解。可能需要去看一下文件。

### 2025.02.10
今天決定將重要的內容給GPT統整
### Modified Merkle-Patricia Trie (MPT) 

## **簡介**
**Modified Merkle-Patricia Trie (MPT)** 是以太坊使用的資料結構，用來儲存區塊鏈的 **狀態(state)**，也就是帳戶資訊、合約儲存（storage）等。它結合了 **Merkle Trie**（梅克爾樹）和 **Patricia Trie**（壓縮前綴樹）的特性，以提供 **高效的鍵值對查詢、插入、刪除，同時確保數據可驗證性**。

---

## **MPT 的三大核心特點**
1. **Merkle Tree 結構**
   - 讓狀態能夠被「加密摘要」保護，確保資料完整性。
   - 任何節點的改變都會影響到根雜湊（root hash），使區塊鏈能快速檢查篡改。

2. **Patricia Trie 結構**
   - 避免標準 Trie 結構的冗長性，透過 **壓縮前綴（path compression）** 優化空間使用。

3. **Modified（修改過的）特性**
   - 針對以太坊的應用，特別優化了存取效率，例如節點類型的設計（leaf node, extension node, branch node）。

---

## **MPT 在以太坊的應用**
以太坊主要有 **三種 MPT**，分別用來管理：
1. **世界狀態樹（State Trie）**
   - 錢包帳戶（externally owned account, EOA）
   - 智能合約帳戶
   - 每個帳戶的 balance、nonce、code hash、storage root

2. **儲存樹（Storage Trie）**
   - 智能合約的 storage 是一個單獨的 trie，每個合約都有自己的儲存樹。

3. **交易樹（Transaction Trie） & 收據樹（Receipt Trie）**
   - 存交易資訊與交易執行結果的收據。

---

## **MPT 的節點類型**
### 1️⃣ **Branch Node（分支節點）**
- 有 16 個子節點（對應 16 進制鍵的 0~F）。
- 有一個額外的值欄位，當鍵完整匹配時存儲數據。

### 2️⃣ **Leaf Node（葉節點）**
- 儲存完整鍵的 **剩餘部分（剩餘前綴）** 及對應值。
- 用於 **終端鍵值對（key-value）** 的存儲。

### 3️⃣ **Extension Node（擴展節點）**
- 儲存一段 **共享的鍵前綴**，避免冗餘。
- 指向下一個節點（可能是 Branch 或 Leaf）。

---

## **為什麼以太坊使用 MPT？**
✅ **節省空間**：Patricia Trie 壓縮了前綴，減少存儲需求。  
✅ **高效查詢**：Trie 結構允許 O(log(n)) 的鍵值查詢，適合區塊鏈高頻讀取需求。  
✅ **可驗證性**：Merkle Tree 讓資料完整性可被驗證，支援 **輕客戶端（Light Client）** 快速驗證區塊內容。  
✅ **資料不變性**：每次狀態改變時，新的 MPT 根哈希會改變，確保篡改可檢測。  

---

## **MPT 的缺點**
❌ **插入、刪除成本較高**：由於哈希運算，每次修改都需要更新樹的路徑。  
❌ **存儲效率問題**：節點是基於 RLP（Recursive Length Prefix）編碼，需要額外的存儲與解析成本。  
❌ **遍歷困難**：不像標準的鍵值存儲結構，不能高效遍歷所有鍵值。  

---
```json
{
  "cat": "meow",
  "dog": "bark",
  "cow": "moo"
}
```
這些鍵（key）會先轉換成十六進制表示：
```json
"cat" → 636174
"dog" → 646F67
"cow" → 636F77
```
MPT 會壓縮公共前綴來構建樹：
```json
Root
 ├── 63 (c)
 │   ├── 61 (a) → "meow"
 │   ├── 6F (o)
 │       ├── 77 (w) → "moo"
 ├── 64 (d) → 6F67 (og) → "bark"
```

### 2025.02.11
TODO : responsibility、p2p、snap
今天看了執行層的詳細架構，但覺得有點太難了，所以用GPT幫我生重點。

以下是針對原文中第 2、3、4、5 部分的詳細解釋：

---

## 1. 區塊結構與區塊處理流程

**區塊結構**  
- 每個區塊作為區塊鏈中的基本單位，包含區塊頭、交易列表以及其他相關元數據。  
- **區塊頭：** 記錄了父區塊的哈希值、時間戳、難度指標、狀態樹根、交易樹根等關鍵參數。這些資訊不僅保證了區塊內容的不可篡改性，也成為驗證區塊合法性的依據。

**區塊處理流程**  
- **交易收集與排序：** 節點從網絡中收集各筆交易，並根據一定的排序規則（例如手續費優先等）進行整理，形成待打包的交易池。
- **區塊生成：** 節點根據共識規則，選取合適的交易打包成區塊，同時計算與該區塊相關的狀態轉換。
- **區塊驗證：** 新生成的區塊會經過嚴格的驗證程序，包括檢查區塊頭資訊、每筆交易的合法性以及狀態轉換的正確性。
- **鏈接與確認：** 驗證通過後，新區塊被其他節點認可並與之前的區塊鏈進行鏈接，從而形成完整且連續的區塊鏈。

---

## 2. 狀態轉換函數

**概念說明**  
- 狀態轉換函數定義了從當前區塊狀態到下一個區塊狀態的轉變規則。每筆交易在執行時，都會根據該函數更新賬戶狀態、智能合約存儲以及其他鏈上數據。

**細節內容**  
- **交易執行：** 每筆交易可能涉及調用智能合約、轉賬或合約部署等操作，其執行結果將改變系統內部狀態。
- **錯誤處理：** 當交易執行過程中遇到錯誤（如資金不足或非法操作）時，系統會根據預設規則進行回滾或標記錯誤，確保不會影響其他交易的正確執行。
- **數據一致性：** 嚴格定義的狀態轉換邏輯確保所有節點在處理相同交易時，能夠得出一致的狀態更新結果，從而維持整個網絡的一致性。

---

## 3. Ethereum 虛擬機（EVM）運作機制

**EVM 基本架構**  
- **指令集與計算模型：** Ethereum 虛擬機（EVM）是一個基於堆疊運算的虛擬機，內置完整的指令集，用以執行智能合約的邏輯。
- **Gas 機制：** 為防止無限循環和濫用資源，EVM 在執行每條指令時都需消耗一定的 gas，且由交易發起者提前支付。這不僅保護了網絡資源，同時也激勵開發者優化合約代碼。

**執行流程**  
- **智能合約執行：** 當合約被調用時，EVM 根據合約代碼逐條執行指令，同時根據設定的 gas 限制進行資源控制。
- **存儲與運算：** 在合約執行過程中，EVM 負責讀取、寫入及計算相關數據，並維護一個內部存儲空間來管理合約狀態。 
- **結果與回執：** 執行結束後，EVM 生成交易回執，其中記錄了執行結果、剩餘 gas 以及在執行過程中產生的事件或錯誤信息。

---

## 4. 交易驗證與處理流程

**交易結構**  
- 每筆交易包含發起方、接收方、轉賬金額、gas 限制與價格以及數據負載（通常用於智能合約的調用）等信息。
- 交易中必須包含數字簽名，以證明發起者的身份和交易的合法性。

**驗證步驟**  
- **格式檢查：** 首先檢查交易數據結構是否符合規範要求。 
- **簽名驗證：** 通過公鑰密碼學方法驗證數字簽名，確保交易來自合法的發起者。
- **Gas 檢查：** 驗證交易所設定的 gas 限制是否合理，並確認發起者賬戶中有足夠餘額支付所需費用，以防濫用網絡資源。 
- **狀態轉換檢查：** 在執行交易前後，對比系統狀態變化是否符合預期，從而防止任何非法或不當的狀態更新。

---

### 2025.02.12
### RPC 遠端程序呼叫
在以太坊及其他區塊鏈中，RPC（Remote Procedure Call，遠端程序呼叫）是一種協定，允許應用程式與區塊鏈節點進行互動。透過RPC，開發者可以查詢區塊鏈資料、發送交易，以及與智能合約互動。

以太坊實現了JSON-RPC規範，這是一種無狀態、輕量級的遠端程序呼叫協定，使用JSON作為資料格式。以太坊客戶端通常支援多種傳輸協定，包括HTTP、WebSocket和IPC，這使得開發者能夠以多種方式與以太坊網路互動。

在區塊鏈生態系統中，RPC是去中心化應用程式（DApps）與區塊鏈網路溝通的關鍵橋樑。開發者可以使用RPC介面查詢區塊資訊、發送交易請求，或與智能合約進行互動。例如，當使用者在DApp中發起交易時，應用程式會透過RPC將交易資訊傳送至區塊鏈節點，節點再將交易廣播至整個網路。

總而言之，RPC在以太坊和其他區塊鏈中扮演著關鍵角色，提供了應用程式與區塊鏈網路之間的溝通管道，支持各種區塊鏈操作的實現。 

### responsibility、p2p、snap
---

### 1. Responsibility（責任／職責分工）

在以太坊架構中，「responsibility」主要描述各系統組件或層級在協議中各自承擔的明確角色與任務。例如：  

- **層級職責分離**  
  自從以太坊完成合併（The Merge）之後，整個系統被劃分為兩大層級：  
  - **執行層（Execution Layer）**：負責處理交易、執行智能合約以及維護帳戶狀態。  
  - **共識層（Consensus Layer）**：負責區塊排序、驗證以及確保全網達成共識。  
  這種分工確保各層均有其明確「責任」，有助於系統模組化、易於維護和未來獨立升級。  

- **節點責任**  
  每個以太坊節點在網路中均承擔著驗證交易與區塊、維護最新網路狀態以及通過 P2P 網絡傳播數據的責任，從而確保網絡的安全性與去中心化運作。  

總體而言，「responsibility」體現了以太坊中「各司其職」的設計理念，是確保系統穩定運作與安全的重要基石。

---

### 2. P2P（點對點網絡）

「P2P」是「peer-to-peer」的縮寫，代表以太坊中節點間進行直接通信的去中心化網路架構，主要特點包括：

- **無中心化伺服器**  
  以太坊網絡中的節點直接互相連接，無需依賴單一中心伺服器。透過分散式網絡協議（如 devp2p），各節點可以互相傳送交易、區塊及狀態資訊，這增強了網絡的抗審查能力與容錯性。

- **節點發現與數據傳輸**  
  節點能自動發現其他節點並建立安全加密的通信鏈路，確保數據（例如交易與區塊資訊）能夠迅速且可靠地在整個網絡中廣播與傳播。

- **網絡健壯性**  
  去中心化的 P2P 結構能有效防止單點故障和集中式攻擊，即使部分節點下線，整個網絡依然可以穩定運作並維持共識。
  
---

### 3. Snap（快照同步機制）

在以太坊中，「snap」通常指的是**snap sync**（快照同步）機制，這是一種用來加速新節點同步的技術手段：

- **狀態快照機制**  
  由於以太坊的歷史數據量龐大，若從創世區塊開始逐筆重放交易來構建最新狀態，所需時間和資源極高。snap sync 機制允許新節點直接從其他已同步的節點下載一份包含當前狀態（如帳戶餘額、智能合約存儲等）的快照，從而跳過重放所有歷史交易的步驟。  

- **快速驗證與更新**  
  節點下載快照後，會進行必要的驗證以確保資料正確無誤。隨後，新節點只需處理快照之後的新區塊，迅速趕上最新狀態，從而大幅縮短同步時間。

- **提升網絡擴展性**  
  snap sync 使得新節點能夠更快接入網絡，降低了同步過程中的計算與存儲負擔，這對於應對網絡規模不斷增長具有重要意義。

總結來看，「snap」在以太坊中代表利用狀態快照進行快速同步的一種高效機制，使新節點無需從頭重放全部歷史交易即可快速獲得最新狀態，從而促進了網絡的高效擴展與穩定運作。

---
### 2025.02.13

今天開始共識層的學習，並且對week2的note做了總結。
下面是一個綜合總結，幫助你快速掌握這些內容的重點：

---

### 總結

**1. 主要內容**  
- 區塊驗證流程  
- 區塊構建機制  
- 狀態轉換函式（STF）、EVM 架構與 P2P 協議
---

**2. 區塊驗證流程**  
- **共識層（CL）：**  
  - 透過 `process_execution_payload` 函式進行初步檢查（如父區塊哈希、時間戳、前一個 randao 值等），
  - 將執行 payload 發送給執行層（EL）進一步驗證。  
  - `notify_new_payload` 函式則負責傳送資料給 EL，但實際狀態轉換由 EL 處理。

- **執行層（EL）：**  
  - 執行狀態轉換函式（STF），主要步驟包括：  
    1. **驗證區塊頭**（如 gas 限制變動、區塊連續性、EIP-1559 基本費更新等），  
    2. **應用交易**：遍歷並執行區塊內的所有交易（遇到錯誤則整塊區塊無效）。  
  - 驗證結果回傳給共識層，若無效，區塊則被拒絕。

---

**3. 區塊構建流程**  
- **主要參數：**  
  - 區塊環境資訊（時間戳、區塊號、前一區塊、基本費等）  
  - 交易池：維持一個依照 gas 價值排序的交易列表  
  - 最新的 StateDB（狀態資料庫）

- **構建步驟：**  
  1. **追蹤 gas 使用與累積交易：** 持續加入交易直至達到 gas 限制。  
  2. **從交易池中挑選最佳交易：** 透過 `Pop()` 方法依據每單位 gas 價值排序取出最高價值的交易執行。  
  3. **Finalize 組裝區塊：** 將所有執行過的交易及區塊相關資訊整合成一個完整的區塊。

- **Q&A 重點：**  
  - 交易池內部排序確保區塊構建者可獲得最大收益；  
  - 交易的有效性主要由交易池先行檢查，只有無效交易會被拒絕；  
  - 加密交易池仍是未來可能解決的挑戰，現階段存在部分資訊洩漏風險。

---

**4. 進一步技術細節：STF、EVM 與 P2P 協議**  
- **狀態轉換函式（STF）：**  
  - 透過 go-ethereum 原始碼中的多個函式（如 `newPayload`、`insertBlockWithoutSetHead`、`insertChain`）實現，驗證並更新區塊狀態。  
  - 每筆交易執行後會生成相應的 Receipt 來記錄執行結果。

- **EVM 架構：**  
  - 包含程式碼、PC、堆疊、記憶體、剩餘 gas、區塊與交易上下文等。  
  - 不同指令（算術、位元、環境、控制流程、堆疊與系統指令）的成本決定，反映了網路運行的負載與效率考量。

- **P2P 協議：**  
  - 以太坊採用 devp2p 協議進行節點間的通訊，涵蓋歷史數據、待處理交易與狀態同步（snap sync）。  
  - 協議中設有多種方法以確保數據正確性，並利用弱主觀性檢查點驗證下載的狀態資料。

---
### 2025.02.14
今天看了共識層，用GPT整理了一些重點。
### 中心化 vs. 分散式運作

• 單一信任運營者模式
 – 一台伺服器依照協議運作，但用戶必須完全信任這個單一運營者，否則容易發生重複花費等問題。

• 分散式節點運作
 – 多個節點共同計算並複製狀態（state machine replication），達成共識，無需信任單一第三方。
 – 即使部分節點出現錯誤或惡意行為，只要大部分節點保持一致，整體系統依然能穩定運作。

### 拜占庭容錯 (BFT) 與共識
• 為何需要BFT？
 – 在開放分散式系統中，節點可能因硬體故障、網路延遲、程式錯誤或攻擊而出現不一致的情況。
 – BFT機制可以讓系統在部分節點失效或惡意的情況下，仍能正確達成共識。

• 兩階段提交 (2PC) 範例
 – 第一階段（Prepare）：某節點詢問其他節點是否能接受某筆交易，當達到2/3超多數確認後，進入下一階段。
 – 第二階段（Commit）：節點根據結果決定提交或中止該筆交易，最終使所有正確節點達成同一狀態。

• 實用型拜占庭容錯 (PBFT)
 – PBFT允許系統在少數節點惡意情況下達成共識。
 – 缺點：在節點數量增加時，通信複雜度迅速上升，也容易遭遇Sybil攻擊（單一實體操控大量節點）。

### PoS
• Validator（驗證者）的角色
 – 成為驗證者需要質押32 ETH，並在以太坊的存款合約中進行登記
 – 驗證者需定期對區塊鏈狀態進行「簽名」確認，包括：
  ○ LMD-GHOST投票：對Beacon鏈的區塊頭進行認可
  ○ Casper-FFG投票：在每個epoch的checkpoint上進行確認

• 基本時間單位與組織結構
 – Slot：每12秒產生一個slot，每個slot內部劃分為三個階段（每階段約4秒），其中4秒為關鍵的簽名截止時間
 – Epoch：由32個slot組成，用來降低共識處理頻率，重負任務（如懲罰與獎勵發放）通常在epoch邊界執行
 – Committee：驗證者會在不同epoch中隨機分組，每位驗證者在其被分配的slot中完成一次簽名

• 最終性（Finality）的概念
 – 當一個checkpoint獲得2/3超多數確認後，其狀態即被認定為「justified」，隨後上一個已justified的checkpoint就會被「finalized」，意味著交易不可逆轉

• 共識算法Gasper
 – 結合了Casper-FFG與LMD-GHOST，用來確定最終的區塊鏈分支，幫助新節點同步正確鏈

### 其他重要概念與未來方向

• 提議者與構建者分離（PBS）
 – 為解決MEV問題（驗證者藉由交易排序獲利），PBS允許區塊提議者將區塊構建外包給專業團隊，從而降低對高端硬體的依賴，維持網路去中心化

• 單slot最終性 (SSF) 與單秘密領導者選舉 (SSLE)
 – SSF目標是在一個slot內達到最終性
 – SSLE則希望在slot內秘密選出區塊提議者，進一步提高安全性和抗操控能力

• 最大有效餘額 (Max Effective Balance)
 – 探討如何提高每位驗證者的有效質押金額（目前設定為32 ETH），以期進一步提升系統的安全性和效能

### 2025.02.16
這幾天比較忙，只有多看一下Gasper：
### Gasper 共識算法深入解析

• Gasper 是以太坊 2.0 Beacon 鏈上的核心共識機制  
 – 它融合了兩大機制：  
  ○ Casper-FFG（最終性機制）：  
   ▪ 驗證者在預定的 checkpoint 上投票，當某個 checkpoint 收到超過 2/3 的票數時，即被標記為「justified」，進而最終完成「finalized」的狀態，確保區塊不可逆轉。  
  ○ LMD-GHOST（分叉選擇規則）：  
   ▪ 驗證者根據自己最新的投票訊息，依據權重選擇支援最多的分支作為鏈頭。這有助於在存在多條競爭分叉時，快速確定哪一條分支擁有最多支持，從而達成共識。

• Gasper 的運作原理與優點：  
 – 驗證者持續廣播他們對區塊的 attestation（簽名投票），LMD-GHOST 規則根據這些最新投票來判定哪個分支為「最佳鏈頭」，使得所有節點能夠趨向統一。  
 – 一旦某一 checkpoint 獲得足夠（通常為 2/3 超多數）的 attestation，Casper-FFG 就將其標記為最終狀態，從而防止長程回滾與重組。  
 – 這種結合既能提供快速的分叉選擇，也能在達到一定票數後保證區塊的最終性，有效協助新加入的節點同步到正確且安全的鏈上狀態。  
 – 同時，Gasper 設計上具備對抗各種攻擊（例如惡意投票或長程攻擊）的能力，確保在分散式環境中能夠持續運作並保持一致性。

• 為何 Gasper 對以太坊至關重要：  
 – 它不僅確保鏈上每個區塊的安全性與不可篡改，還幫助新節點在同步過程中能夠辨識出正確的區塊鏈分支，降低誤連接錯誤鏈的風險。  
 – 這種混合共識設計使得系統能在面臨網路延遲、節點故障或惡意行為時依然能快速收斂並達成共識，進一步增強了整體網路的健壯性與安全性。

參考資料中亦有關於 Gasper 機制與相關細節的介紹，可供進一步閱讀與理解。

### 2025.02.17
今天看了一下week4的內容，提到了一些跟測試和bug有關的東西：

## **1. 執行層（Execution Layer, EL）測試**
### **EVM 測試**
- **目標**：確保所有執行客戶端符合規範，以避免鏈分叉（fork）。
- **測試結構**：
  - **前狀態（Pre-state）**：以太坊鏈的完整組成，包括帳戶、餘額、nonce、合約代碼與儲存狀態。
  - **環境變數（Environment）**：包括時間戳、區塊號、Gas 限制、Base Fee、硬分叉激活時間等。
  - **交易（Transactions）**：區塊鏈上的訊息，影響帳戶狀態。
  - **後狀態（Post-state）**：執行後的區塊鏈狀態變化。

### **測試填充（Test Filling）**
- **定義**：將測試源碼編譯成通用測試夾具（fixture），以便所有執行客戶端使用。
- **與客戶端單元測試的區別**：
  - 測試填充（Test Filling）：所有客戶端可執行相同測試。
  - 客戶端單元測試（Client Unit Testing）：不同客戶端的測試可能有所不同。

### **EVM 測試格式**
- **狀態測試（State Testing）**：
  - 檢查不同客戶端在相同輸入下是否生成相同的**狀態根（State Root）**。
- **模糊測試（Fuzzy Testing）**：
  - 使用 **FuzzyVM** 在智能合約中引入隨機變數，並檢測不同客戶端是否仍能產生相同結果。
- **區塊鏈測試（Blockchain Testing）**：
  - 測試完整區塊執行，包括 EIP-1559 Base Fee 的計算。
- **負面測試（Negative Testing）**：
  - 故意插入**無效區塊**，檢查客戶端是否能正確拒絕無效區塊並回滾到先前的有效區塊。

---

## **2. 共識層（Consensus Layer, CL）測試**
- **特點**：
  - 測試生成的測試夾具可供所有客戶端使用。
  - **獨立測試**：測試可直接在規範（spec）內編寫，不依賴任何 CL 客戶端。
  - 以 **Python** 編寫，方便擴展。

---

## **3. 跨層測試（Cross-Layer Testing）**
- **測試 EL（執行層）與 CL（共識層）之間的互動**。
- **驗證區塊鏈從創世區塊（Genesis Block）到特定區塊的正確性**。

## **4. 以太坊安全性風險**
### **執行層（EL）風險**
- **有效區塊被錯誤拒絕（Valid Invalidation）**。
- **無效區塊被錯誤接受（Invalid Validation）**。
- **區塊執行時的 DoS 攻擊**：
  - 透過惡意交易導致客戶端執行時間過長，影響網絡效能。

### **共識層（CL）風險**
- **故障節點影響鏈最終確定性（Finalization）**：
  - < 33% 故障節點 → 會導致插槽錯過（Missed Slots），但鏈仍可最終確定。
  - 33% - 50% 故障節點 → 可能導致最終確定性延遲。
  - 50% - 66% 故障節點 → 可能破壞分叉選擇（Fork Choice）。
  - > 66% 故障節點 → 可能導致錯誤的鏈最終確定。

---
### 2025.02.19
今天特別去學習了一下新的以太坊升級的EIP，特別提幾個：
EIP-7702
這是在講一個AA錢包的實行，可以透過利用EOA錢包中空的code space去記錄一個smart contract，進而去做到把EOA錢包變身成一個CA的感覺，可以透過簽名發送set up code去做到。
EIP‑7251
增加可質押上限到2048ETH，且可以複利。
EIP‑6110
減少staking在CL確認的延遲（10 hrs -> 13 mins）。
### 2025.02.20
今天再把昨天eth Taipei meetup的東西稍微學一下，主要是Blob:
blob主要指的是 proto-danksharding（EIP-4844）中的 blob-carrying transactions，這是一種新的交易類型，目的是提升 Ethereum 的可擴展性，特別是 L2（Layer 2）解決方案的成本與效率。
新的升級預計也會增加目前Blob的數量。
### 2025.02.21
今天看roadmap中跟layer2或scale相關的資訊：
你的筆記概括了 **Ethereum Roadmap** 中的 **Surge** 和 **Scourge** 階段，這兩個階段主要關注 **可擴展性**（L2 Rollups 數據可用性）和 **MEV 的影響**（減少負面影響）。我來補充細節，讓這些概念更完整。

---

## Surge：提升 Ethereum L2 Rollup 的數據可用性**
### **目標**
- **核心目標**：增強 L2 Rollups 的數據可用性（Data Availability, DA），降低 Rollups 成本，提升 Ethereum 的擴展性。
- **具體影響**：Rollup 交易費用降低，讓更多人能負擔 Ethereum 生態系統的使用成本。

### **關鍵技術**
1. **EIP-4844（Proto-Danksharding / Blobspace）**
   - **引入 blob-carrying transactions**，這是一種特殊的交易格式，攜帶 L2 數據，但不會影響 Ethereum 的長期狀態存儲。
   - **更便宜的數據儲存方式**，相比 calldata，blob 使用專門的 blob gas 定價機制，大幅降低 Rollup 發佈數據的成本。

2. **允許節點處理較大數據區塊（Blob）**
   - 透過 **blob-only data layer**，Ethereum 節點不必永久存儲所有交易數據，只需短期維護 blob，之後即可丟棄。
   - 這讓 L2 Rollup 可以高效發佈數據，不影響 Ethereum L1 的狀態增長。

3. **未來支持 Data Availability Sampling（DAS）**
   - **DAS（數據可用性抽樣）**：未來 Danksharding 完成後，節點可以透過隨機抽樣方式驗證數據是否存在，而不需要存儲完整數據。
   - **對驗證者的影響**：
     - 減少驗證 L2 數據的負擔。
     - 讓小型節點也能參與共識，而不需要儲存所有 Rollup 數據。

### **影響**
- **對 Rollup**
  - 提供更低成本的數據發佈方式，降低交易費用。
  - 讓 L2 繼續擴展，而不影響 Ethereum 的核心架構。
- **對 L1**
  - 增加了新的 blob 交易類型，但 Ethereum 狀態增長仍然受控。

---

## Scourge：解決 MEV 問題，減少負面影響**
### **目標**
- **減少 MEV（Maximal Extractable Value）的負面影響**，避免區塊提議者（proposer）透過惡意交易排序來獲取過多利潤，損害用戶體驗與去中心化。
- **防止網絡中心化**，目前 MEV 的問題導致許多驗證者依賴外部中介（如 Flashbots），增加了審查與中心化風險。

### **關鍵技術**
1. **提案者與建設者分離（PBS, Proposer-Builder Separation）**
   - **概念**：
     - **區塊提案者（Proposer）**：負責選擇區塊，但不排序交易。
     - **區塊建設者（Builder）**：負責構建區塊（包含交易排序）。
   - **作用**：
     - 提案者無法直接透過交易排序獲取 MEV。
     - Builder 競爭提供最優的區塊建構方式，減少中心化。
   - **目前狀況**：透過 **MEV-Boost** 這種第三方 PBS 實作，但未來會內建到 Ethereum 協議中。

2. **MEV-Boost**
   - **現狀**：目前 Ethereum 驗證者使用 **Flashbots 提供的 MEV-Boost** 來獲取 MEV 收益，這是一種中介機制。
   - **問題**：
     - 這仍然是一種「外部 PBS」，增加了審查風險（OFAC Blacklist 影響）。
     - 可能導致一部分 Builder 壟斷區塊建構，形成中心化。

3. **Enshrined PBS（內建 PBS）**
   - 計劃直接將 **PBS 整合進 Ethereum 協議**，不依賴 Flashbots 或外部 MEV 服務。
   - **影響**：
     - 提高抗審查能力。
     - 讓所有驗證者都能公平參與 MEV 收益，而不是依賴外部組織。

4. **Inclusion Lists（確保交易不會被過度審查）**
   - **概念**：
     - 建議 Ethereum 強制區塊提案者（Proposer）在區塊中包含一定數量的「合法交易」，防止過度審查。
   - **應對問題**：
     - Flashbots 和其他 MEV-Boost 服務可能會對某些交易（如 Tornado Cash 相關交易）進行審查。
     - Inclusion Lists 確保不論交易類型，區塊內都會有一定的交易被納入，防止中心化中介影響交易自由。

---

## **結論**
### **Surge（EIP-4844 / Blobspace）**
- 主要目標：提升 Ethereum L2 擴展性，降低 Rollup 成本。
- 方式：Blob 交易、數據可用性抽樣（DAS），未來 Danksharding 會進一步提升。
- 影響：更便宜的 L2 交易費用，使 Ethereum 更容易普及。

### **Scourge（PBS / MEV 防範機制）**
- 主要目標：減少 MEV 壟斷與交易審查風險。
- 方式：Enshrined PBS、MEV-Boost、Inclusion Lists，讓驗證者不被 MEV 操控。
- 影響：更公平的交易排序機制，提升去中心化，減少 Flashbots 等中心化中介的影響。
### 2025.02.22
今天突然突然想想了解一下UTXO:

### 1. UTXO（未花費交易輸出）
- **定義**：UTXO 指的是在區塊鏈上某筆交易的輸出部分，該部分金額尚未被後續交易花費，因此仍可作為未來交易的輸入。
- **作用**：它代表著具體的、可支配的資金單位，每筆交易都會消耗現有的 UTXO 並生成新的 UTXO。
- **特點**：每個 UTXO 都包含了特定金額及其鎖定條件（通常與特定地址相關聯），只有滿足鎖定條件的用戶才能花費該 UTXO。

### 2. 地址
- **定義**：地址是一個由公鑰生成的字串，類似於銀行帳戶號碼，用來接收和存儲 UTXO。
- **作用**：它充當身份識別的角色，告訴網絡資金應該發送到哪裡；當你發起交易時，實際上是引用與該地址相關聯的 UTXO。
- **特點**：一個地址可以對應多個 UTXO，區塊鏈中的餘額通常是該地址下所有 UTXO 的累積總和。

### 3. 核心差異
- **概念層次**：
  - UTXO 是交易中的基本資金單位，反映了資金的具體狀態（已花費或未花費）。
  - 地址則是識別符號，用來歸集和管理這些 UTXO。
- **作用和用途**：
  - UTXO 用於構成交易的輸入和輸出，確保交易的透明和可驗證性。
  - 地址用於接收 UTXO，相當於資金的「存放位置」或「帳戶」。
- **關係**：
  - 一個地址可以擁有多個 UTXO；而 UTXO 必須通過地址來鎖定所有權，只有擁有該地址私鑰的用戶才能解鎖並使用這些 UTXO。

總而言之，UTXO 是區塊鏈交易中具體的資金單位，而地址則是管理和接收這些資金的識別標籤。

### 2025.02.23
今天看了替代掉 MPT 的 Verkle Trees：
樹狀結構：
Verkle Trees 與 Merkle Tree 一樣，都是一種樹狀資料結構，用來儲存大量的鍵值對資料。但不同的是，Verkle Trees 的每個節點並不僅僅包含一個單一的哈希值，而是利用向量承諾來綜合多個子節點的資訊。

向量承諾：
向量承諾允許對一組數據（例如，一個節點中的多個子節點資料）進行一次性承諾，並且在需要時能夠針對其中的部分數據生成簡潔的證明。這種技術能夠顯著縮短驗證證明的長度，並減少資料傳輸量。

這樣的好處是可以在更短的時間生成出證明，進而減少通訊的開銷，且狀態的存儲也可以變得更加高效。

### 2025.02.24
今天看了新的內容，關於分片和DAS：
分片（Sharding）
分片技術的主要目標是將區塊鏈網路拆分成多個獨立的「分片」，使得每個分片可以平行處理交易。這樣不但能大幅增加整個網路的交易吞吐量，還能降低每個節點所需處理的資料量，進而促進去中心化。

數據可用性抽樣（Data Availability Sampling, DAS）
DAS 技術允許節點只需隨機抽取區塊中一部分資料，就能從統計上確保整個區塊數據都是可用的。這利用了糾刪碼（erasure coding）等方法，使得即便節點不儲存全部數據，仍能驗證資料完整性，減少對帶寬與存儲資源的需求。


### 2025.02.25
---

### 主題
主要圍繞三大主軸展開：

1. **以協議視角看問題（Seeing like a protocol）**
2. **區塊生產服務（Block production service）**
3. **共識服務（Consensus service）**

---

### 1. 以協議視角看問題
- Ethereum協議由分散的社群治理，目標是透過去中心化提供區塊空間，達成最大化用戶福利、最小化租金。
- 協議透過驗證者（Validators）運行，驗證者負責執行區塊建構、共識及反審查等服務。
- 驗證者與協議間存在資訊不對稱問題，協議透過內省（Introspection）與代理（Agency）機制，取得可信的環境訊號，並據此進行更新、獎勵與懲罰。

---

### 2. 區塊生產服務（Block Production Service）
- 驗證者作為區塊生產者，配置資源（Gas）滿足用戶需求（交易）。
- Ethereum採用動態的擁堵定價機制（EIP-1559），以目標區塊Gas使用量調整基礎費用，進行資源內省。
- EIP-4844進一步將執行Gas（exec-gas）與數據可用性Gas（DA-gas）分開，提供給Layer 2 Rollups使用。

#### 區塊生產與建構者的分離
- 區塊建構服務委託給專業的建構者（Builders），驗證者僅負責共識，形成所謂「區塊提議者-建構者分離（PBS）」機制。

---

### 3. 共識服務（Consensus Service）
- 以Casper FFG機制完成鏈的最終確認（Finality），使用LMD-GHOST選擇鏈的頭部（Chain Head）。
- 驗證者需要質押資金，以保證良好的服務提供並承擔潛在損失（slashing）。
- 質押的資金逐漸轉為流動性質押協議（Liquid Staking Protocols, LSP），但過度集中可能導致去中心化減弱。

#### 驗證者分類
- **獨立運營者（Solo operators）**：可信度需長期觀察。
- **專業運營者（Professional operators）**：通常受信任，但可能產生中心化壓力。
- 提倡區分「輕量級委託者」與「重量級委託者」，降低中心化風險。

---

### 區塊共創（Block Co-creation）
- 鼓勵Ethereum最去中心化的驗證者群體提出他們的區塊內容偏好。
- 透過機制如EIP-7547（Inclusion lists）、ROP-9（Multiplicity gadgets）、COMIS（委員會式強制包含集合）達成。

---

### Bonus: 發行量（Issuance）
- 發行量高，質押ETH的人數增加，導致流動性質押Token（LST）可能轉為貨幣性質。
- 近期提案探討適度調整發行曲線，如Electra proposal，進一步維護質押經濟的平衡性。

---
### 2025.02.26
今天繼續到第三週：
### 1. 狀態到期機制（State Expiry）
目的： 旨在定期清除或封存那些長期未使用的帳戶及合約存儲，防止全網狀態資料無限增長，降低節點存儲負擔。
運作方式： 將鏈狀態按固定時期劃分成不同的區段（例如每一年一個時期），新狀態存於最新的區段；舊區段則只保留加密承諾，必要時可藉由提供證明「復活」舊狀態。
意義： 使節點只需保存近期狀態，達到有限存儲要求，並與無狀態客戶端（stateless clients）相結合，從而提升整體網絡的擴展性和去中心化。

### 2. 以太坊無狀態化路線圖（General Stateless Ethereum Roadmap）
核心理念： 透過讓每個區塊攜帶必要的「見證」（witness），使節點在驗證區塊時不必保存整個世界狀態，只需依靠這些小型證明即可正確執行和驗證交易。
關鍵技術：
Verkle 樹： 以取代現有的 Merkle Patricia 樹，極大縮減見證資料的大小。
歷史及狀態到期： 與 EIP-4444（歷史數據修剪）及狀態到期相輔相成，最終實現節點存儲需求大幅下降。
影響： 節點啟動速度更快、硬件需求降低，進而促進更多參與者運行全節點，進一步提高去中心化與網絡安全性。

### 2025.02.27
今天看了EOF，覺得很有創意。
現行以太坊智能合約的位元碼格式為一連串的純位元組序列，缺乏了版本控制的功能。
EOF 變更的主要目的是對現有格式進行「結構化」改造，透過引入版本號、明確劃分程式碼區與資料區，使 EVM（以太坊虛擬機）能夠更靈活、安全地進行升級與功能擴展。
優點：
1. 新舊合約共存： 舊版本的合約仍可按照原有邏輯執行，而新版本則可享有改進後的功能。
逐步淘汰不安全操作碼： 如 SELFDESTRUCT 等可能存在安全風險的操作碼，可在新版本中被2. 禁用或替換；同時，新版本合約的部署者也能更清楚知曉其執行環境。
3. 未來升級彈性： 當 EVM 需要引入重大改動時，不必擔心破壞現有合約，因為只需將新功能限定在新版格式中，降低了升級過程的風險。
### 2025.02.28
今天時間少，看了地址空間擴展。
額外元數據：
擴展到 32 字節後，可以將地址拆分為多個部分，例如：

版本號字段： 用於標示地址格式的版本（如 0x01 表示新格式）。
保留/分片字段： 預留空間用於未來存放分片 ID 或其他用途。
時期（Epoch）字段： 用於記錄地址創建的時期，幫助解決狀態到期時可能出現的地址重用問題。
剩餘部分： 仍然保留足夠的雜湊值（例如 Keccak256 輸出）以確保地址唯一性和安全性。
在過渡期內，網路上可能同時存在 20 字節（舊格式）與 32 字節（新格式）的地址。常見的解決方案包括：

地址轉換映射： 當新舊地址進行互動時，可以透過內部映射或轉換機制，將 20 字節地址轉換成 32 字節（例如在前面補零）或反之，從而保持兼容性。
雙模式運行： 部分合約和客戶端可以同時支援舊格式和新格式，根據地址中的版本號來決定採用哪一套處理邏輯。

### 2025.03.02
LOG Reform
現有設計的問題：
當前以太坊每個區塊標頭都包含一個 2048 位元的 LOG Bloom Filter，用以快速查詢該區塊中出現過哪些事件（logs）。然而，這種 Bloom Filter 的設計隨著網路交易量增加而變得不精確，導致查詢時出現大量假陽性（false positives），實際上大部分應用（例如 DApp 查詢）都依賴外部索引服務（如 The Graph）而非直接透過 Bloom Filter 查詢。
此外，維護 Bloom Filter 也增加了區塊生成和驗證的額外運算負擔，影響節點效能。

改革目標：
事件 LOG 改革旨在解決上述問題，讓區塊鏈內部能夠更精確、有效率地記錄與查詢事件數據，同時降低節點在產生與驗證 LOG 時的計算與存儲負擔。這不僅可以提升輕節點的查詢效能，也有助於未來支持無狀態化的輕量級客戶端。
EIP-7668
該提案主張從區塊和交易收據中完全移除 Bloom Filter。取而代之的是，區塊內不再記錄 Bloom 資料，這可以減少區塊標頭的大小，並簡化節點在區塊驗證時的運算流程。
優點：
減少不必要的資料運算與存儲；因為目前 Bloom Filter 的精確度較低，其實用性有限。
缺點：
去除 Bloom Filter 後，輕節點和用戶需要依賴外部或專門的查詢機制（例如去中心化的事件索引網絡）來檢索特定事件。

<!-- Content_END -->
